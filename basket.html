<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ê°•ì‹ ì²­ ë¯¸ë‹ˆê²Œì„</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f8f9fa;
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            user-select: none;  /* ì „ì²´ ë“œë˜ê·¸ ë°©ì§€ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .container {
            width: 1200px;  /* ìˆ˜ì •: ì»¨í…Œì´ë„ˆ ë„ˆë¹„ ì¦ê°€ */
            padding: 30px;
            margin: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }
        .tab-navigation {
            display: flex;
            gap: 5px;
            margin-bottom: -1px;
            width: 1200px;  /* ìˆ˜ì •: íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ë„ˆë¹„ë„ í•¨ê»˜ ì¦ê°€ */
            padding: 0 30px;
            margin-top: 0;
            position: relative;
            z-index: 2;
        }
        .tab-link {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            color: #495057;
            text-decoration: none;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        .tab-link:hover {
            background-color: #e9ecef;
        }
        .tab-link.active {
            background-color: white;
            color: #007bff;
            font-weight: bold;
            position: relative;
            z-index: 3;
        }
        .tab-link.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background-color: white;
            z-index: 3;
        }
        .course-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .course-table th, .course-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }
        /* ê° ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì • */
        .course-table th:nth-child(1), 
        .course-table td:nth-child(1) {  /* No */
            width: 40px;
        }
        .course-table th:nth-child(2), 
        .course-table td:nth-child(2) {  /* êµ¬ë¶„ */
            width: 70px;
        }
        .course-table th:nth-child(3), 
        .course-table td:nth-child(3) {  /* ì´ìˆ˜êµ¬ë¶„ */
            width: 70px;
        }
        .course-table th:nth-child(4), 
        .course-table td:nth-child(4) {  /* ìº í¼ìŠ¤ */
            width: 60px;
        }
        .course-table th:nth-child(5), 
        .course-table td:nth-child(5) {  /* í•™ìˆ˜ë²ˆí˜¸-ë¶„ë°˜ */
            width: 120px;
        }
        .course-table th:nth-child(6), 
        .course-table td:nth-child(6),
        .course-table th:nth-child(7), 
        .course-table td:nth-child(7) {  /* í•™ë…„, í•™ì  */
            width: 45px;
        }
        .course-table th:nth-child(8), 
        .course-table td:nth-child(8) {  /* êµê³¼ëª©ëª… */
            width: 120px;  /* 200pxì—ì„œ 120pxë¡œ ê°ì†Œ */
        }
        .course-table th:nth-child(9), 
        .course-table td:nth-child(9) {  /* ë‹´ë‹¹êµìˆ˜ */
            width: 80px;
        }
        .course-table th:nth-child(10), 
        .course-table td:nth-child(10) {  /* ê°•ì˜ì‹œê°„ ë° ê°•ì˜ì‹¤ */
            width: 120px;
        }
        .course-table th:nth-child(11), 
        .course-table td:nth-child(11) {  /* ê°•ì˜í‰ê°€ */
            width: 60px;
        }
        .course-table th {
            background-color: #f8f9fa;
            font-weight: normal;
            color: #495057;
        }
        .course-table tr:hover {
            background-color: #f8f9fa;
        }
        .submit-btn {
            padding: 2px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .submit-btn:hover {
            background-color: #0056b3;
        }
        .author-info {
            text-align: right;
            color: #adb5bd;
            font-size: 0.8em;
            margin-bottom: 20px;
        }
        .author-info a {
            color: inherit;
            text-decoration: none;
        }
        .author-info a:hover {
            text-decoration: underline;
        }
        .author-info .separator {
            margin: 0 2px;
        }
        .status-btn {
            padding: 2px 8px;
            background-color: #1abedf;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            width: 65px;  /* ê³ ì • ë„ˆë¹„ ì„¤ì • */
            text-align: center;
            white-space: nowrap;
            display: flex;  /* ì¶”ê°€ */
            align-items: center;  /* ì¶”ê°€ */
            justify-content: center;  /* ì¶”ê°€ */
            height: 24px;  /* ì¶”ê°€: ë†’ì´ ê³ ì • */
        }
        .status-btn:hover {
            background-color: #31d2f2;
        }
        .course-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
            white-space: nowrap;  /* ì¶”ê°€: ì¤„ë°”ê¿ˆ ë°©ì§€ */
            max-width: 200px;     /* ì¶”ê°€: ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            overflow: hidden;     /* ì¶”ê°€: ë„˜ì¹˜ëŠ” ë‚´ìš© ìˆ¨ê¹€ */
            text-overflow: ellipsis;  /* ì¶”ê°€: ë„˜ì¹˜ëŠ” ë‚´ìš© ... ì²˜ë¦¬ */
        }
        .timer-section {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: space-between;
        }
        .timer-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        #timer {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
            font-family: inherit;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        #timer .time-number {
            font-family: inherit;
        }
        .start-btn {
            background-color: #28a745;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .start-btn.cancel {
            background-color: #dc3545;
        }
        .start-btn.restart {
            background-color: #1abedf;
        }
        .record-text {
            color: #28a745;
            font-weight: bold;
            display: none;
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        .settings-section {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .settings-header {
            font-weight: bold;
            color: #212529;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: space-between;  /* ì¶”ê°€: ì–‘ìª½ ì •ë ¬ */
        }
        .settings-left-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .course-count {
            background-color: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.9em;
            min-width: 24px;
            text-align: center;
        }
        .settings-controls {
            display: flex;
            gap: 10px;
        }
        .settings-options {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: 15px;
        }
        .difficulty-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }
        .difficulty-controls select {
            padding: 2px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            height: 24px;  /* ë†’ì´ ì§€ì • */
        }
        .difficulty-controls label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;  /* ë§ˆì§„ ì œê±° */
            height: 24px;  /* ë†’ì´ ì§€ì • */
        }
        .status-btn:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
        }
        .countdown-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px 50px;
            border-radius: 8px;
            display: none;
            z-index: 1000;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .countdown-popup.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        .countdown-number {
            font-size: 2em;
            margin-top: 10px;
            color: #1abedf;
            transition: transform 0.3s ease;
        }
        .countdown-number.pulse {
            transform: scale(1.2);
        }
        .popup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            display: none;
            z-index: 1000;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .popup.show {
            opacity: 1;
        }
        @keyframes slideDown {
            from {
                transform: translate(-50%, -100%);
            }
            to {
                transform: translate(-50%, 0);
            }
        }
        .popup.animate {
            animation: slideDown 0.3s ease forwards;
        }
        .popup-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        .popup-btn {
            background-color: white;
            color: #28a745;
            border: none;
            border-radius: 4px;
            padding: 3px 15px;
            cursor: pointer;
            font-weight: bold;
        }
        .popup-btn:hover {
            background-color: #f8f9fa;
        }
        .control-btn {
            background-color: #1abedf;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 1px 12px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .control-btn:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
        }
        .control-btn:not(:disabled):hover {
            background-color: #31d2f2;
        }
        .status-btn.full {
            background-color: #dc3545;
            cursor: not-allowed;
            padding: 2px 4px;  /* íŒ¨ë”© ì¡°ì • */
        }
        .status-btn.full:hover {
            background-color: #dc3545;
        }
        .bgm-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;  /* ì¶”ê°€: ìš°ì¸¡ ì •ë ¬ */
        }
    </style>
</head>
<body>
    <div class="tab-navigation">
        <a href="index.html" class="tab-link">í•™ìˆ˜ë²ˆí˜¸</a>
        <a href="basket.html" class="tab-link active">ì¥ë°”êµ¬ë‹ˆ</a>
    </div>
    <div class="container">
        <div class="timer-section">
            <div class="timer-container">
                <button onclick="toggleTimer()" id="startBtn" class="start-btn" tabindex="-1">ì‹œì‘</button>
                <div id="timer" tabindex="-1">00:00:00.000</div>
            </div>
            <div class="author-info">
                <a href="https://github.com/Floyre/Sugang_Master" target="_blank">Sugang_Master</a><span class="separator">/</span><a href="https://github.com/Floyre" target="_blank">Floyre</a>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-header">
                <div class="settings-left-group">
                    <span>ê³¼ëª© ìˆ˜ ì„¤ì •</span>
                    <span class="course-count" id="courseCount">5</span>
                    <div class="settings-controls">
                        <button onclick="addCourse()" class="control-btn" id="addBtn">+ ì¶”ê°€</button>
                        <button onclick="removeCourse()" class="control-btn" id="removeBtn">- ì œê±°</button>
                    </div>
                    <div class="settings-options">
                        <label>
                            <input type="checkbox" id="difficultyUp" onchange="toggleDifficultyControls()">
                            ë‚œì´ë„ UP! ì¸ì›ì´ˆê³¼ ë„£ê¸°
                        </label>
                        <div class="difficulty-controls" id="difficultyControls" style="display: none;">
                            <label>ì¸ì›ì´ˆê³¼ ìˆ˜:</label>
                            <select id="fullRowCount">
                                <option value="1">1ê°œ</option>
                                <option value="2">2ê°œ</option>
                                <option value="3">3ê°œ</option>
                            </select>
                        </div>
                    </div>
                </div>
                <label class="bgm-toggle">
                    <input type="checkbox" id="bgmToggle" checked>
                    ì†Œë¦¬ ì¼œê¸°
                </label>
            </div>
        </div>

        <table class="course-table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>êµ¬ë¶„</th>
                    <th>ì´ìˆ˜êµ¬ë¶„</th>
                    <th>ìº í¼ìŠ¤</th>
                    <th>í•™ìˆ˜ë²ˆí˜¸-ë¶„ë°˜</th>
                    <th>í•™ë…„</th>
                    <th>í•™ì </th>
                    <th>êµê³¼ëª©ëª…</th>
                    <th>ë‹´ë‹¹êµìˆ˜</th>
                    <th>ê°•ì˜ì‹œê°„ ë° ê°•ì˜ì‹¤</th>
                    <th>ê°•ì˜í‰ê°€</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td><button class="status-btn" onclick="handleClick(this)">ì‹ ì²­</button></td>
                    <td>ì „ì„ </td>
                    <td>ì „ì²´</td>
                    <td>HBHA4388-1</td>
                    <td>3</td>
                    <td>3</td>
                    <td>ì‚¬íšŒì–¸ì–´í•™</td>
                    <td>ì„œì€ì•„</td>
                    <td>ëª©1,2,3(107)</td>
                    <td>ì¡°íšŒ</td>
                </tr>
                <!-- ë‚˜ë¨¸ì§€ ê³¼ëª©ë“¤ë„ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ì¶”ê°€ -->
            </tbody>
        </table>

        <div class="record-text" id="recordText"></div>
    </div>

    <div id="countdownPopup" class="countdown-popup">
        <div>ì¤€ë¹„í•˜ì„¸ìš”...</div>
        <div class="countdown-number" id="countdownNumber"></div>
    </div>

    <audio id="startSound" preload="auto">
        <source src="sound/start.mp3" type="audio/mpeg">
    </audio>

    <audio id="finishSound" preload="auto">
        <source src="sound/finish.mp3" type="audio/mpeg">
    </audio>

    <audio id="passSound" preload="auto">
        <source src="sound/pass2.mp3" type="audio/mpeg">
    </audio>

    <audio id="beginSound" preload="auto">
        <source src="sound/begin.mp3" type="audio/mpeg">
    </audio>

    <audio id="bgmSound" preload="auto" loop>
        <source src="sound/bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="popup" class="popup">
        <div class="popup-content">
            <div>ì‹ ì²­ ë˜ì—ˆìŠµë‹ˆë‹¤</div>
            <button class="popup-btn" onclick="closePopup()">í™•ì¸</button>
        </div>
    </div>

    <script>
        let timerInterval;
        let startTime;
        let remainingButtons;

        // ëœë¤ ê°’ ìƒì„± í•¨ìˆ˜ë“¤
        function getRandomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateRandomCourseCode() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += getRandomElement(letters);
            }
            code += getRandomNumber(1000, 9999);
            return code;
        }

        function getRandomPeriods() {
            // 1ë¶€í„° 8ê¹Œì§€ì˜ ìˆ«ì ë°°ì—´ ìƒì„±
            const periods = Array.from({length: 8}, (_, i) => i + 1);
            
            // ë°°ì—´ì„ ì„ê³  ì•ì—ì„œ 3ê°œ ì„ íƒí•˜ì—¬ ì •ë ¬
            return shuffleArray([...periods])
                .slice(0, 3)
                .sort((a, b) => a - b)
                .join(',');
        }

        function createCourseRow(index) {
            const courseTypes = ['ì „ì„ ', 'êµì„ ', 'êµí•„'];
            const weekdays = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            
            const courseType = getRandomElement(courseTypes);
            const courseCode = generateRandomCourseCode();
            const section = getRandomNumber(1, 9);
            const year = getRandomNumber(1, 4);
            const credit = getRandomNumber(1, 3);
            const weekday = getRandomElement(weekdays);
            const room = getRandomNumber(100, 999);
            const periods = getRandomPeriods();  // ëœë¤í•œ 3ê°œ êµì‹œ ìƒì„±

            return `
                <tr>
                    <td>${index}</td>
                    <td><button class="status-btn" onclick="handleClick(this)">ì‹ ì²­</button></td>
                    <td>${courseType}</td>
                    <td>ì „ì²´</td>
                    <td>${courseCode}-${section}</td>
                    <td>${year}</td>
                    <td>${credit}</td>
                    <td>ìˆ˜ê°•ì‹ ì²­</td>
                    <td>í™”ì´íŒ…!</td>
                    <td>${weekday}${periods}(${room})</td>
                    <td>ì¡°íšŒ</td>
                </tr>
            `;
        }

        function createFullRow(index) {
            const courseTypes = ['ì „ì„ ', 'êµì„ ', 'êµí•„'];
            const weekdays = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            
            const courseType = getRandomElement(courseTypes);
            const courseCode = generateRandomCourseCode();
            const section = getRandomNumber(1, 9);
            const year = getRandomNumber(1, 4);
            const credit = getRandomNumber(1, 3);
            const weekday = getRandomElement(weekdays);
            const room = getRandomNumber(100, 999);
            const periods = getRandomPeriods();  // ëœë¤í•œ 3ê°œ êµì‹œ ìƒì„±

            return `
                <tr>
                    <td>${index}</td>
                    <td><button class="status-btn full" disabled>ì¸ì›ì´ˆê³¼</button></td>
                    <td>${courseType}</td>
                    <td>ì „ì²´</td>
                    <td>${courseCode}-${section}</td>
                    <td>${year}</td>
                    <td>${credit}</td>
                    <td>ìˆ˜ê°•ì‹ ì²­</td>
                    <td>í™”ì´íŒ…!</td>
                    <td>${weekday}${periods}(${room})</td>
                    <td>ì¡°íšŒ</td>
                </tr>
            `;
        }

        function updateButtons() {
            const tbody = document.querySelector('.course-table tbody');
            const itemCount = tbody.children.length;
            document.getElementById('removeBtn').disabled = itemCount <= 1;
            document.getElementById('addBtn').disabled = itemCount >= 10;
        }

        function toggleDifficultyControls() {
            const controls = document.getElementById('difficultyControls');
            const checkbox = document.getElementById('difficultyUp');
            controls.style.display = checkbox.checked ? 'flex' : 'none';
            
            // ê³¼ëª© ìˆ˜ì— ë”°ë¼ ì„ íƒ ê°€ëŠ¥í•œ ì¸ì›ì´ˆê³¼ ìˆ˜ ì¡°ì •
            updateFullRowOptions();
        }

        function updateFullRowOptions() {
            const tbody = document.querySelector('.course-table tbody');
            const totalRows = tbody.children.length;
            const maxFullRows = totalRows;  // ìˆ˜ì •: ê³¼ëª© ìˆ˜ë§Œí¼ ì¸ì›ì´ˆê³¼ ì¶”ê°€ ê°€ëŠ¥
            const select = document.getElementById('fullRowCount');
            
            select.innerHTML = '';  // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            for(let i = 1; i <= maxFullRows; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + 'ê°œ';
                select.appendChild(option);
            }
        }

        function updateCourseCount() {
            const count = document.querySelector('.course-table tbody').children.length;
            document.getElementById('courseCount').textContent = count;
        }

        function addCourse() {
            const tbody = document.querySelector('.course-table tbody');
            const currentCount = tbody.children.length;
            if (currentCount < 10) {
                tbody.insertAdjacentHTML('beforeend', createCourseRow(currentCount + 1));
                updateButtons();
                updateFullRowOptions();
                updateCourseCount();  // ê³¼ëª© ìˆ˜ ì—…ë°ì´íŠ¸
            }
        }

        function removeCourse() {
            const tbody = document.querySelector('.course-table tbody');
            if (tbody.children.length > 1) {
                tbody.removeChild(tbody.lastElementChild);
                updateButtons();
                updateFullRowOptions();
                updateCourseCount();  // ê³¼ëª© ìˆ˜ ì—…ë°ì´íŠ¸
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function playSound(sound) {
            if (document.getElementById('bgmToggle').checked) {
                // pass2 ì†Œë¦¬ëŠ” 0.1, ë‚˜ë¨¸ì§€ëŠ” 0.25ë¡œ ì„¤ì •
                sound.volume = (sound.id === 'passSound') ? 0.1 : 0.25;
                sound.currentTime = 0;
                return sound.play().catch(function(error) {
                    console.log("ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:", error);
                });
            }
            return Promise.resolve();  // ì†Œë¦¬ê°€ êº¼ì ¸ìˆì„ ë•ŒëŠ” ë°”ë¡œ resolve
        }

        function startCountdown() {
            const popup = document.getElementById('countdownPopup');
            const numberDisplay = document.getElementById('countdownNumber');
            const startSound = document.getElementById('startSound');
            const startBtn = document.getElementById('startBtn');  // ì¶”ê°€
            let count = 3;

            // ì‹œì‘ ë²„íŠ¼ ë¹„í™œì„±í™”
            startBtn.disabled = true;  // ì¶”ê°€

            playSound(startSound);

            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            popup.style.display = 'block';
            numberDisplay.textContent = count;
            
            setTimeout(() => {
                popup.classList.add('show');
                numberDisplay.classList.add('pulse');
            }, 10);

            setTimeout(() => {
                numberDisplay.classList.remove('pulse');
            }, 200);

            const countInterval = setInterval(() => {
                count--;
                
                if (count > 0) {
                    numberDisplay.textContent = count;
                    numberDisplay.classList.add('pulse');
                    setTimeout(() => {
                        numberDisplay.classList.remove('pulse');
                    }, 200);
                } else {
                    clearInterval(countInterval);
                    popup.classList.remove('show');
                    setTimeout(() => {
                        popup.style.display = 'none';
                        
                        const beginSound = document.getElementById('beginSound');
                        
                        // begin ì‚¬ìš´ë“œê°€ ëë‚˜ë©´ BGM ì‹œì‘
                        beginSound.addEventListener('ended', function() {
                            if (document.getElementById('bgmToggle').checked) {
                                const bgmSound = document.getElementById('bgmSound');
                                playSound(bgmSound);
                            }
                        }, { once: true });

                        playSound(beginSound).then(() => {
                            startGame();
                            startBtn.disabled = false;  // ê²Œì„ ì‹œì‘ í›„ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                        }).catch(function(error) {
                            console.log("begin ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:", error);
                            startGame();
                            startBtn.disabled = false;  // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë²„íŠ¼ í™œì„±í™”
                        });
                    }, 300);
                }
            }, 1000);
        }

        function startGame() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 10);
            
            const tbody = document.querySelector('.course-table tbody');
            const difficultyUp = document.getElementById('difficultyUp').checked;
            
            if (difficultyUp) {
                // ê¸°ì¡´ í–‰ë“¤ì˜ í•™ìˆ˜ë²ˆí˜¸ì™€ ë¶„ë°˜ ì •ë³´ ì €ì¥
                const originalCourses = Array.from(tbody.children).map((row, index) => ({
                    haksu: `HBHA4388-${index + 1}`,
                    index: index + 1
                }));
                
                // ì¸ì›ì´ˆê³¼ í–‰ ê°œìˆ˜ëŠ” ì‚¬ìš©ìê°€ ì„ íƒí•œ ê°’ ì‚¬ìš©
                const fullRowCount = parseInt(document.getElementById('fullRowCount').value);
                
                // ì „ì²´ í–‰ ë°°ì—´ ìƒì„± (ì‹ ì²­ ê°€ëŠ¥ + ì¸ì›ì´ˆê³¼)
                const allRows = [];
                let normalIndex = 0;
                
                // ëª¨ë“  ìœ„ì¹˜ë¥¼ ëœë¤í•˜ê²Œ ê²°ì •
                const totalPositions = originalCourses.length + fullRowCount;
                const fullPositions = new Set();
                
                while(fullPositions.size < fullRowCount) {
                    const pos = Math.floor(Math.random() * totalPositions);
                    fullPositions.add(pos);
                }
                
                // í–‰ ë°°ì—´ ìƒì„±
                for(let i = 0; i < totalPositions; i++) {
                    const rowIndex = i + 1;  // ìˆœì°¨ì ì¸ ì¸ë±ìŠ¤ ì‚¬ìš©
                    if (!fullPositions.has(i)) {
                        // ì‹ ì²­ ê°€ëŠ¥í•œ ê³¼ëª©
                        allRows.push(createCourseRow(rowIndex));
                        normalIndex++;
                    } else {
                        // ì¸ì›ì´ˆê³¼ ê³¼ëª©
                        allRows.push(createFullRow(rowIndex));
                    }
                }
                
                // tbody ì—…ë°ì´íŠ¸
                tbody.innerHTML = allRows.join('');
            }

            // ë²„íŠ¼ ìƒíƒœ ì„¤ì •
            const buttons = document.querySelectorAll('.status-btn:not(.full)');
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.style.backgroundColor = '#1abedf';
            });
            remainingButtons = buttons.length;

            // ì„¤ì • ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('addBtn').disabled = true;
            document.getElementById('removeBtn').disabled = true;
            document.getElementById('difficultyUp').disabled = true;

            const btn = document.getElementById('startBtn');
            btn.textContent = 'ì·¨ì†Œ';
            btn.classList.add('cancel');
        }

        function resetTable() {
            const tbody = document.querySelector('.course-table tbody');
            const currentCount = tbody.children.length;
            const normalCount = document.querySelectorAll('.status-btn:not(.full)').length;
            
            tbody.innerHTML = '';  // í…Œì´ë¸” ì´ˆê¸°í™”
            
            // ì‹ ì²­ ê°€ëŠ¥í–ˆë˜ ê³¼ëª© ìˆ˜ë§Œí¼ ìƒˆë¡œìš´ í–‰ ì¶”ê°€
            for (let i = 0; i < normalCount; i++) {
                tbody.insertAdjacentHTML('beforeend', createCourseRow(i + 1));
            }
        }

        function toggleTimer() {
            const btn = document.getElementById('startBtn');
            
            if (!timerInterval) {
                if (btn.textContent === 'ë‹¤ì‹œí•˜ê¸°') {
                    btn.textContent = 'ì‹œì‘';
                    btn.classList.remove('restart');
                    document.getElementById('recordText').style.display = 'none';
                    document.getElementById('timer').innerHTML = 
                        `<span class="time-number">00</span>:<span class="time-number">00</span>:<span class="time-number">00</span>.<span class="time-number">000</span>`;
                    document.getElementById('difficultyUp').disabled = false;
                    
                    // í…Œì´ë¸” ì´ˆê¸°í™” ì¶”ê°€
                    resetTable();
                    return;
                }
                startCountdown();
            } else {
                clearInterval(timerInterval);
                timerInterval = null;
                document.getElementById('timer').innerHTML = 
                    `<span class="time-number">00</span>:<span class="time-number">00</span>:<span class="time-number">00</span>.<span class="time-number">000</span>`;
                
                // ëª¨ë“  ì˜¤ë””ì˜¤ ì •ì§€
                const audioElements = ['startSound', 'beginSound', 'bgmSound', 'passSound', 'finishSound'];
                audioElements.forEach(id => {
                    const sound = document.getElementById(id);
                    sound.pause();
                    sound.currentTime = 0;
                });

                // í…Œì´ë¸” ì´ˆê¸°í™” ì¶”ê°€
                resetTable();

                // ì„¤ì • ë²„íŠ¼ í™œì„±í™”
                updateButtons();

                btn.textContent = 'ì‹œì‘';
                btn.classList.remove('cancel');
                document.getElementById('recordText').style.display = 'none';
                document.getElementById('difficultyUp').disabled = false;
            }
        }

        function showPopup() {
            const popup = document.getElementById('popup');
            
            // ëª¨ë“  ì‹ ì²­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.status-btn').forEach(btn => {
                if (!btn.disabled) {
                    btn.style.pointerEvents = 'none';
                }
            });
            
            popup.style.display = 'block';
            setTimeout(() => {
                popup.classList.add('show', 'animate');
            }, 10);
        }

        function closePopup() {
            const popup = document.getElementById('popup');
            popup.classList.remove('show');
            
            setTimeout(() => {
                popup.style.display = 'none';
                popup.classList.remove('animate');
                
                // ì‹ ì²­ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                document.querySelectorAll('.status-btn').forEach(btn => {
                    if (!btn.disabled) {
                        btn.style.pointerEvents = 'auto';
                    }
                });
            }, 300);
        }

        function handleClick(button) {
            if (!timerInterval) return;

            showPopup();

            button.disabled = true;
            button.style.backgroundColor = '#adb5bd';
            remainingButtons--;

            // ë§ˆì§€ë§‰ ë²„íŠ¼ì´ ì•„ë‹ ë•Œë§Œ pass ì‚¬ìš´ë“œ ì¬ìƒ
            if (remainingButtons > 0) {
                const passSound = document.getElementById('passSound');
                playSound(passSound);
            }

            if (remainingButtons === 0) {
                clearInterval(timerInterval);
                timerInterval = null;

                // BGM ì •ì§€
                const bgmSound = document.getElementById('bgmSound');
                bgmSound.pause();
                bgmSound.currentTime = 0;

                const finalTime = document.getElementById('timer').textContent;
                document.getElementById('recordText').textContent = 
                    `ğŸ˜  ë‹¹ì‹ ì˜ ìˆ˜ê°•ì‹ ì²­ ê¸°ë¡  :  ${finalTime} ğŸ”¥  `;
                document.getElementById('recordText').style.display = 'block';

                // finish ì‚¬ìš´ë“œ ì¬ìƒ
                const finishSound = document.getElementById('finishSound');
                playSound(finishSound);

                const btn = document.getElementById('startBtn');
                btn.textContent = 'ë‹¤ì‹œí•˜ê¸°';
                btn.classList.remove('cancel');
                btn.classList.add('restart');

                updateButtons();
            }
        }

        function updateTimer() {
            const currentTime = Date.now();
            const elapsedTime = new Date(currentTime - startTime);
            const hours = String(elapsedTime.getUTCHours()).padStart(2, '0');
            const minutes = String(elapsedTime.getUTCMinutes()).padStart(2, '0');
            const seconds = String(elapsedTime.getUTCSeconds()).padStart(2, '0');
            const milliseconds = String(elapsedTime.getUTCMilliseconds()).padStart(3, '0');
            
            document.getElementById('timer').innerHTML = 
                `<span class="time-number">${hours}</span>:<span class="time-number">${minutes}</span>:<span class="time-number">${seconds}</span>.<span class="time-number">${milliseconds}</span>`;
        }

        // ì´ˆê¸° ì„¤ì •
        window.addEventListener('load', function() {
            const tbody = document.querySelector('.course-table tbody');
            tbody.innerHTML = '';  // ê¸°ì¡´ í–‰ ì œê±°
            for (let i = 0; i < 5; i++) {  // ê¸°ë³¸ 5ê°œ í•­ëª© ì¶”ê°€
                tbody.insertAdjacentHTML('beforeend', createCourseRow(i + 1));
            }
            updateButtons();
            updateFullRowOptions();
            updateCourseCount();  // ì´ˆê¸° ê³¼ëª© ìˆ˜ ì„¤ì •
            
            // BGM ì²´í¬ë°•ìŠ¤ ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('bgmToggle').checked = true;
        });
    </script>
</body>
</html> 